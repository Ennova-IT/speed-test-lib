<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>JSpeedTest</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">JSpeedTest</h1>
      <h2 class="project-tagline">Speed Test library for Java/Android</h2>
      <a href="https://github.com/akinaru/speed-test-lib" class="btn">View on GitHub</a>
      <a href="https://github.com/akinaru/speed-test-lib/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/akinaru/speed-test-lib/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="jspeedtest" class="anchor" href="#jspeedtest" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JSpeedTest</h1>

<p><a href="https://travis-ci.org/akinaru/speed-test-lib"><img src="https://travis-ci.org/akinaru/speed-test-lib.svg?branch=master" alt="Build Status"></a>
<a href="https://bintray.com/akinaru/maven/speedtest/_latestVersion"><img src="https://api.bintray.com/packages/akinaru/maven/speedtest/images/download.svg" alt="Download"> </a>
<a href="https://maven-badges.herokuapp.com/maven-central/com.github.akinaru/speedtest"><img src="https://maven-badges.herokuapp.com/maven-central/com.github.akinaru/speedtest/badge.svg" alt="Maven Central"></a>
<a href="https://coveralls.io/github/akinaru/speed-test-lib?branch=master"><img src="https://coveralls.io/repos/github/akinaru/speed-test-lib/badge.svg?branch=master" alt="Coverage Status"></a>
<a href="https://www.codacy.com/app/kiruazoldik92/speed-test-lib?utm_source=github.com&amp;amp;utm_medium=referral&amp;amp;utm_content=akinaru/speed-test-lib&amp;amp;utm_campaign=Badge_Grade"><img src="https://api.codacy.com/project/badge/Grade/55e8e347e0d24566b37fe43799665e40" alt="Codacy Badge"></a>
<a href="http://javadoc-badge.appspot.com/com.github.akinaru/speedtest"><img src="http://javadoc-badge.appspot.com/com.github.akinaru/speedtest.svg?label=javadoc" alt="Javadoc"></a>
<a href="LICENSE.md"><img src="http://img.shields.io/:license-mit-blue.svg" alt="License"></a></p>

<p>Speed Test client library for Java/Android with HTTP &amp; FTP support</p>

<ul>
<li>speed test download</li>
<li>speed test upload</li>
<li>download / upload progress monitoring</li>
<li>configurable hostname / port / uri (username &amp; password for FTP)</li>
<li>configurable socket timeout and chunk size</li>
</ul>

<p>Check a <a href="https://github.com/akinaru/speed-test-lib/blob/master/server_list.md">non-exhaustive list</a> of compatible speed test server.</p>

<h2>
<a id="include-in-your-project" class="anchor" href="#include-in-your-project" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Include in your project</h2>

<ul>
<li>with Gradle, from jcenter or mavenCentral :</li>
</ul>

<pre><code>compile 'com.github.akinaru:speedtest:1.21'
</code></pre>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<ul>
<li>setup a speed test listener to monitor progress, completion and error catch :</li>
</ul>

<pre><code>SpeedTestSocket speedTestSocket = new SpeedTestSocket();

// add a listener to wait for speedtest completion and progress
speedTestSocket.addSpeedTestListener(new ISpeedTestListener() {

    @Override
    public void onDownloadFinished(SpeedTestReport report) {
        // called when download is finished
        System.out.println("[DL FINISHED] rate in octet/s : " + report.getTransferRateOctet());
        System.out.println("[DL FINISHED] rate in bit/s   : " + report.getTransferRateBit());
    }

    @Override
    public void onDownloadError(SpeedTestError speedTestError, String errorMessage) {
         // called when a download error occur
    }

    @Override
    public void onUploadFinished(SpeedTestReport report) {
        // called when an upload is finished
        System.out.println("[UL FINISHED] rate in octet/s : " + report.getTransferRateOctet());
        System.out.println("[UL FINISHED] rate in bit/s   : " + report.getTransferRateBit());
    }

    @Override
    public void onUploadError(SpeedTestError speedTestError, String errorMessage) {
        // called when an upload error occur
    }

    @Override
    public void onDownloadProgress(float percent, SpeedTestReport report) {
        // called to notify download progress
        System.out.println("[DL PROGRESS] progress : " + percent + "%");
        System.out.println("[DL PROGRESS] rate in octet/s : " + report.getTransferRateOctet());
        System.out.println("[DL PROGRESS] rate in bit/s   : " + report.getTransferRateBit());
    }

    @Override
    public void onUploadProgress(float percent, SpeedTestReport report) {
        // called to notify upload progress
        System.out.println("[UL PROGRESS] progress : " + percent + "%");
        System.out.println("[UL PROGRESS] rate in octet/s : " + report.getTransferRateOctet());
        System.out.println("[UL PROGRESS] rate in bit/s   : " + report.getTransferRateBit());
    }

    @Override
    public void onInterruption() {
        // triggered when forceStopTask is called
    }
});
</code></pre>

<h3>
<a id="download" class="anchor" href="#download" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Download</h3>

<ul>
<li>HTTP download 1Mo from <code>2.testdebit.info</code>
</li>
</ul>

<pre><code>speedTestSocket.startDownload("2.testdebit.info", "/fichiers/1Mo.dat");
</code></pre>

<ul>
<li>FTP download 1Mo from <code>speedtest.tele2.net</code>
</li>
</ul>

<pre><code>speedTestSocket.startFtpDownload("speedtest.tele2.net", "/1MB.zip");
</code></pre>

<h3>
<a id="upload" class="anchor" href="#upload" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Upload</h3>

<ul>
<li>HTTP upload 1Mo to <code>2.testdebit.info</code>
</li>
</ul>

<pre><code>speedTestSocket.startUpload("2.testdebit.info", "/", 1000000);
</code></pre>

<ul>
<li>FTP upload a 1Mo file to <code>speedtest.tele2.net</code>
</li>
</ul>

<pre><code>String fileName = SpeedTestUtils.generateFileName() + ".txt";
speedTestSocket.startFtpUpload("speedtest.tele2.net", "/upload/" + fileName, 1000000);
</code></pre>

<h3>
<a id="fixed-duration-download" class="anchor" href="#fixed-duration-download" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Fixed duration download</h3>

<p>Download during a fixed duration. Download will be stopped when the max duration is reached.
At the end of the max duration, <code>onInterruption</code> is called if download has not be fully completed</p>

<ul>
<li>HTTP download for 10s max, a 100 Mo file from <code>2.testdebit.info</code>
</li>
</ul>

<pre><code>speedTestSocket.startFixedDownload("2.testdebit.info", "/fichiers/100Mo.dat", 10000);
</code></pre>

<ul>
<li>FTP download for 10s max, a 100 Mo file from <code>speedtest.tele2.net</code>
</li>
</ul>

<pre><code>speedTestSocket.startFtpFixedDownload("speedtest.tele2.net", "/100MB.zip");
</code></pre>

<h3>
<a id="fixed-duration-upload" class="anchor" href="#fixed-duration-upload" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Fixed duration Upload</h3>

<p>Upload during a fixed duration. Upload will be stopped when the max duration is reached
At the end of the max duration, <code>onInterruption</code> is called if upload has not be fully completed</p>

<ul>
<li>HTTP upload for 10s max, a 10Mo file to <code>2.testdebit.info</code>
</li>
</ul>

<pre><code>speedTestSocket.startFixedUpload("2.testdebit.info", "/", 10000000, 10000);
</code></pre>

<ul>
<li>FTP upload for 10s max, a 10Mo file to <code>speedtest.tele2.net</code>
</li>
</ul>

<pre><code>String fileName = SpeedTestUtils.generateFileName() + ".txt";
speedTestSocket.startFtpFixedUpload("speedtest.tele2.net", "/upload/" + fileName, 10000000, 10000);
</code></pre>

<h3>
<a id="define-report-interval" class="anchor" href="#define-report-interval" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Define report interval</h3>

<p>You can define your own report interval (interval between each <code>onDownloadProgress</code> &amp; <code>onUploadProgress</code>) in milliseconds.</p>

<ul>
<li>HTTP download with download reports each 1.5 seconds</li>
</ul>

<pre><code>speedTestSocket.startDownload("2.testdebit.info", "/fichiers/1Mo.dat", 1500);
</code></pre>

<ul>
<li>FTP download with download reports each 1.5 seconds</li>
</ul>

<pre><code>speedTestSocket.startFtpDownload("speedtest.tele2.net", "/1MB.zip", 1500);
</code></pre>

<ul>
<li>HTTP upload with upload reports each 1.5 seconds</li>
</ul>

<pre><code>speedTestSocket.startUpload("2.testdebit.info", "/", 10000000, 1500);
</code></pre>

<ul>
<li>FTP upload with upload reports each 1.5 seconds</li>
</ul>

<pre><code>String fileName = SpeedTestUtils.generateFileName() + ".txt";
speedTestSocket.startFtpUpload("speedtest.tele2.net", "/upload/" + fileName, 10000000, 1500);
</code></pre>

<h3>
<a id="chain-downloadupload-requests" class="anchor" href="#chain-downloadupload-requests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Chain download/upload requests</h3>

<p>You can chain multiple download/upload requests during a fixed duration. This way, there will be as much download/upload request until the end of the period</p>

<ul>
<li>download repeat</li>
</ul>

<p>The following will download regularly for 20 seconds a file of 1Mo with download report each 2 seconds. Download reports will appear in <code>onReport</code> callback of <code>IRepeatListener</code> instead of <code>onDownloadProgress</code> :</p>

<pre><code>speedTestSocket.startDownloadRepeat("2.testdebit.info", "/fichiers/1Mo.dat",
    20000, 2000, new
            IRepeatListener() {
                @Override
                public void onFinish(final SpeedTestReport report) {
                    // called when repeat task is finished
                }

                @Override
                public void onReport(final SpeedTestReport report) {
                    // called when a download report is dispatched
                }
            });
</code></pre>

<ul>
<li>upload repeat</li>
</ul>

<p>The following will upload regularly for 20 seconds a file of 1Mo with download report each 2 seconds. Upload reports will appear in <code>onReport</code> callback of <code>IRepeatListener</code> instead of <code>onUploadProgress</code> :</p>

<pre><code>speedTestSocket.startUploadRepeat("2.testdebit.info", "/", 1000000
    20000, 2000, new
            IRepeatListener() {
                @Override
                public void onFinish(final SpeedTestReport report) {
                    // called when repeat task is finished
                }

                @Override
                public void onReport(final SpeedTestReport report) {
                    // called when an upload report is dispatched
                }
            });
</code></pre>

<h3>
<a id="get-live-download--upload" class="anchor" href="#get-live-download--upload" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get live download &amp; upload</h3>

<ul>
<li>retrieve current download report : </li>
</ul>

<pre><code>SpeedTestReport getLiveDownloadReport()
</code></pre>

<ul>
<li>retrieve current upload report : </li>
</ul>

<pre><code>SpeedTestReport getLiveUploadReport()
</code></pre>

<h3>
<a id="set-size-of-each-packet-sent-to-upload-server" class="anchor" href="#set-size-of-each-packet-sent-to-upload-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Set size of each packet sent to upload server</h3>

<pre><code>speedTestSocket.setUploadChunkSize(65535);
</code></pre>

<h3>
<a id="set-socket-timeout-value" class="anchor" href="#set-socket-timeout-value" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Set socket timeout value</h3>

<p>You can set download/upload socket timeout in milliseconds :</p>

<pre><code>speedTestSocket.setSocketTimeout(5000);
</code></pre>

<h3>
<a id="set-transfer-rate-precision" class="anchor" href="#set-transfer-rate-precision" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Set transfer rate precision</h3>

<p>These settings are used to alter transfer rate float rounding / scale :</p>

<ul>
<li>set RoundingMode :</li>
</ul>

<pre><code>speedTestSocket.setDefaultRoundingMode(RoundingMode.HALF_EVEN);
</code></pre>

<p>Default <code>RoundingMode</code> used for transfer rate calculation is <code>HALF_EVEN</code>. It can be override with : </p>

<ul>
<li>set Scale :</li>
</ul>

<pre><code>speedTestSocket.setDefaultScale(4);
</code></pre>

<p>Default scale used for transfer rate calculation is 4</p>

<h2>
<a id="android-integration" class="anchor" href="#android-integration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Android Integration</h2>

<ul>
<li>add Internet permission to manifest : </li>
</ul>

<pre><code>&lt;uses-permission android:name="android.permission.INTERNET" /&gt;
</code></pre>

<ul>
<li>use an <code>AsyncTask</code> to run your speed test :</li>
</ul>

<pre><code>public class SpeedTestTask extends AsyncTask&lt;Void, Void, String&gt; {

    @Override
    protected String doInBackground(Void... params) {

        SpeedTestSocket speedTestSocket = new SpeedTestSocket();

        // add a listener to wait for speedtest completion and progress
        speedTestSocket.addSpeedTestListener(new ISpeedTestListener() {

            @Override
            public void onDownloadFinished(SpeedTestReport report) {
                // called when download is finished
                Log.v("speedtest", "[DL FINISHED] rate in octet/s : " + report.getTransferRateOctet());
                Log.v("speedtest", "[DL FINISHED] rate in bit/s   : " + report.getTransferRateBit());
            }

            @Override
            public void onDownloadError(SpeedTestError speedTestError, String errorMessage) {
                // called when a download error occur
            }

            @Override
            public void onUploadFinished(SpeedTestReport report) {
                // called when an upload is finished
                Log.v("speedtest", "[UL FINISHED] rate in octet/s : " + report.getTransferRateOctet());
                Log.v("speedtest", "[UL FINISHED] rate in bit/s   : " + report.getTransferRateBit());
            }

            @Override
            public void onUploadError(SpeedTestError speedTestError, String errorMessage) {
                // called when an upload error occur
            }

            @Override
            public void onDownloadProgress(float percent, SpeedTestReport report) {
                // called to notify download progress
                Log.v("speedtest", "[DL PROGRESS] progress : " + percent + "%");
                Log.v("speedtest", "[DL PROGRESS] rate in octet/s : " + report.getTransferRateOctet());
                Log.v("speedtest", "[DL PROGRESS] rate in bit/s   : " + report.getTransferRateBit());
            }

            @Override
            public void onUploadProgress(float percent, SpeedTestReport report) {
                // called to notify upload progress
                Log.v("speedtest", "[UL PROGRESS] progress : " + percent + "%");
                Log.v("speedtest", "[UL PROGRESS] rate in octet/s : " + report.getTransferRateOctet());
                Log.v("speedtest", "[UL PROGRESS] rate in bit/s   : " + report.getTransferRateBit());
            }

            @Override
            public void onInterruption() {
                // triggered when forceStopTask is called
            }
        });

        speedTestSocket.startDownload("2.testdebit.info", "/fichiers/1Mo.dat");

        return null;
    }
}
</code></pre>

<p>Execute it with : <code>new SpeedTestTask().execute();</code></p>

<h2>
<a id="features-examples" class="anchor" href="#features-examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Features examples</h2>

<p>All following examples use speed test server <code>1.testdebit.info</code> for HTTP and <code>speedtest.tele2.net</code> for FTP</p>

<ul>
<li>HTTP download (1Mo)</li>
</ul>

<pre><code>./gradlew downloadFile
</code></pre>

<ul>
<li>HTTP upload (1Mo)</li>
</ul>

<pre><code>./gradlew uploadFile
</code></pre>

<ul>
<li>FTP download (1Mo)</li>
</ul>

<pre><code>./gradlew downloadFTP
</code></pre>

<ul>
<li>FTP upload (1Mo)</li>
</ul>

<pre><code>./gradlew uploadFTP
</code></pre>

<ul>
<li>download during a fixed duration (size: 100Mo, duration: 15s, report interval: 1s)</li>
</ul>

<pre><code>./gradlew fixedDownload
</code></pre>

<ul>
<li>upload during a fixed duration (size: 100Mo, duration: 15s, report interval: 1s)</li>
</ul>

<pre><code>./gradlew fixedUpload
</code></pre>

<ul>
<li>download repeatedly a file during a fixed duration (size:10Mo, duration 11s, report interval: 1s)</li>
</ul>

<pre><code>./gradlew repeatDownload
</code></pre>

<ul>
<li>upload repeatedly a file during a fixed duration (size:1Mo, duration 11s, report interval: 1s)</li>
</ul>

<pre><code>./gradlew repeatUpload
</code></pre>

<ul>
<li>successive 2 x (download + upload) repeatedly a file during a fixed duration (1 download size:1Mo, duration 3s, report interval: 1s following by 1 upload size:1Mo, duration 3s, report interval: 1s)</li>
</ul>

<pre><code>./gradlew repeatChain
</code></pre>

<h2>
<a id="speed-test-issues" class="anchor" href="#speed-test-issues" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Speed Test issues</h2>

<p>It's important to choose an adequate speed test server depending on latency/jitter. This library is <strong>not</strong> responsible for the speed test server choice.</p>

<p>Note that this library :</p>

<ul>
<li>doesn't adjust the chunk size depending on the connection speed either</li>
<li>doesn't provide pre-estimation of the connection speed based on small chunk sent to/from server</li>
<li>doesn't detect anomaly either (for instance taking away X% slowest chunk and X% fastest chunk downloaded)</li>
</ul>

<p>This library does provide an average of transfer rate for all individual chunks read/written for download/upload.</p>

<p>The 2 following links describe the process of speedtest.net :</p>

<ul>
<li><a href="http://www.ookla.com/support/a21110547/what-is-the-test-flow-and-methodology-for-the-speedtest">http://www.ookla.com/support/a21110547/what-is-the-test-flow-and-methodology-for-the-speedtest</a></li>
<li><a href="https://support.speedtest.net/hc/en-us/articles/203845400-How-does-the-test-itself-work-How-is-the-result-calculated-">https://support.speedtest.net/hc/en-us/articles/203845400-How-does-the-test-itself-work-How-is-the-result-calculated-</a></li>
</ul>

<h2>
<a id="compatibility" class="anchor" href="#compatibility" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Compatibility</h2>

<p>JRE 1.7 compliant</p>

<h2>
<a id="build--test" class="anchor" href="#build--test" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Build &amp; test</h2>

<ul>
<li>build without test :</li>
</ul>

<pre><code>./gradlew clean build -x test
</code></pre>

<ul>
<li>build with test :</li>
</ul>

<pre><code>./gradlew clean build
</code></pre>

<ul>
<li>run specific test</li>
</ul>

<pre><code>./gradlew test --tests "fr.bmartel.speedtest.test.SpeedTestFunctionalTest"
</code></pre>

<h2>
<a id="external-libraries" class="anchor" href="#external-libraries" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>External libraries</h2>

<ul>
<li><a href="https://github.com/akinaru/http-endec">http-endec</a></li>
<li><a href="https://commons.apache.org/proper/commons-net/">Apache Commons Net</a></li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>The MIT License (MIT) Copyright (c) 2016 Bertrand Martel</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/akinaru/speed-test-lib">Speed Test library</a> is maintained by <a href="https://github.com/akinaru">akinaru</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
